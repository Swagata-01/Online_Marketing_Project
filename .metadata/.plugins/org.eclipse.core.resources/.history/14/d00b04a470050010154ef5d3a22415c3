package com.cts.service;

import java.util.List;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.cts.dto.RequestDTO;
import com.cts.dto.ResponseDTO;
import com.cts.entity.User;
import com.cts.exception.InvalidInputException;
import com.cts.mapper.UserMapper;
import com.cts.repository.UserRepository;
import com.cts.util.PasswordUtil;

@Service
public class UserService {

    @Autowired
    private UserRepository userRepository;

    public ResponseDTO createUser(RequestDTO requestDTO) {
//		if (requestDTO.getFirstName().isBlank() || requestDTO.getLastName().isBlank() || !requestDTO.getEmail().contains("@") || requestDTO.getPassword().isBlank() || requestDTO.getAddress().isBlank() || requestDTO.getContactNumber().isBlank() || requestDTO.getDateOfBirth()==null) {
//            throw new InvalidInputException("Invalid input");
//        }
		User user = UserMapper.toEntity(requestDTO);
        user.setPassword(PasswordUtil.hashPassword(user.getPassword()));
        User savedUser = userRepository.save(user);
        return UserMapper.toDTO(savedUser);

    }


    public List<ResponseDTO> getAllUsers() {
        return userRepository.findAll().stream()
                .map(UserMapper::toDTO)
                .collect(Collectors.toList());
    }
}